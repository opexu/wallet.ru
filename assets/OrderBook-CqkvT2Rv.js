import{d as N,u as F,e as T,g as R,c as x,b as E,s as P,h as H,i as J}from"./settings-store-DTR8FBrr.js";import{d as I,s as C,r as g,f as $,w as y,u as t,o as B,b as w,t as U,a as p,h as Q,i as W,j as z,k as V,l as K,m as M,c as G,n as X}from"./index-CIGB-tjG.js";const Y={class:"w-full h-fit flex flex-row items-center justify-between font-bold dark:text-primary-500"},Z={class:"text-xs p-2 border rounded-md border-primary-500"},q=I({__name:"Order",props:{title:{},data:{}},setup(_){const n=N(R).greater("sm"),r=F(),{activePair:d}=C(r),i=g(),{height:o}=T(i);return(a,f)=>(B(),$(t(P),{header:a.title,class:"w-full h-full flex flex-col overflow-hidden",pt:{header:{class:"h-12"},title:{class:"dark:text-primary-500"},toggleablecontent:{class:"h-full overflow-hidden"},content:{class:"h-full overflow-hidden"}},"pt-options":{mergeProps:!0}},{header:y(()=>[w("div",Y,[w("span",null,U(a.title),1),w("span",Z,U(t(d).title),1)])]),default:y(()=>[w("div",{ref_key:"orderBookContainer",ref:i,class:"w-full h-full relative flex overflow-hidden"},[p(t(E),{value:a.data,scrollable:"",scrollHeight:t(o)+"px",size:"small",class:"w-full h-full"},{default:y(()=>[p(t(x),{header:"Price",field:"price",sortable:""}),p(t(x),{header:"Quantity",field:"quantity",sortable:""}),t(n)?(B(),$(t(x),{key:0,header:"Total",sortable:"",field:h=>(h.price*h.quantity).toFixed(5).toString()},null,8,["field"])):Q("",!0)]),_:1},8,["value","scrollHeight"])],512)]),_:1},8,["header"]))}}),D=W("OrderStore",()=>{const _=g(100),v=F(),{activePair:n}=C(v),r=z(()=>n.value.title.split("/").join(""));V(r,e=>{f.value=h(e),A(),b()});const d=g([]),i=g([]);let o=null,a=null;const f=g(h(r.value));function h(e){return`wss://stream.binance.com:9443/ws/${e.toLowerCase()}@depth`}const{status:ae,data:j,send:re,open:A,close:oe}=H(f);V(j,e=>{if(!e||!o)return;let s=null;try{s=JSON.parse(e)}catch{s=null,console.error("error at parse ws data")}if(!s)return;const{U:l,u,a:S,b:c,s:m}=s;m===r.value&&(u<=o||(l<=o+1&&u>=o+1?(a=s,O(d.value,a.a),O(i.value,a.b),o=u):(console.warn("something going wrong, updateOrders"),b())))});function O(e,s){const l=s.length;for(let u=0;u<l;u++){const S=s[u],c=parseFloat(S[0]),m=parseFloat(S[1]);if(m===0)continue;if(c>e[0].price){e.unshift({price:c,quantity:m}),e.pop();continue}if(c<e[e.length-1].price)continue;const k=e.findIndex(L=>L.price<=c);e[k].price===c?e.splice(k,1,{price:c,quantity:m}):(e.splice(k,0,{price:c,quantity:m}),e.pop())}}async function b(){const s=await(await fetch(`https://api.binance.com/api/v3/depth?symbol=${r.value}&limit=${_.value}`)).json();d.value=s.asks.map(l=>({price:parseFloat(l[0]),quantity:parseFloat(l[1])})),i.value=s.bids.map(l=>({price:parseFloat(l[0]),quantity:parseFloat(l[1])})),o=s.lastUpdateId}return K(async()=>{f.value=h(r.value),b()}),M(()=>{}),{limit:_,asksArr:d,bidsArr:i,updateOrders:b}}),ee={id:"order-book",class:"w-full h-full flex flex-col gap-2 overflow-hidden"},te={ref:"orderBookContainer",class:"w-full h-full flex flex-row gap-2 overflow-hidden"},se={id:"test",class:"w-full h-fit flex flex-row items-center justify-end"},ie=I({__name:"OrderBook",setup(_){const v=D(),{limit:n,asksArr:r,bidsArr:d}=C(v),{updateOrders:i}=v;return(o,a)=>(B(),G("div",ee,[w("div",te,[p(q,{title:"BIDS",data:t(d)},null,8,["data"]),p(q,{title:"ASKS",data:t(r)},null,8,["data"])],512),p(t(P),{pt:{header:{class:"hidden"},content:{class:"p-2 pt-2"}},"pt-options":{mergeProps:!1}},{default:y(()=>[w("div",se,[p(t(J),{modelValue:t(n),"onUpdate:modelValue":[a[0]||(a[0]=f=>X(n)?n.value=f:null),t(i)],options:[100,500,1e3],placeholder:t(n).toString()},null,8,["modelValue","placeholder","onUpdate:modelValue"])])]),_:1})]))}});export{ie as default};
